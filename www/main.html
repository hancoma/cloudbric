
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: gap: content:">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#2196f3">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <title>Cloudbric App</title>
    <link rel="stylesheet" href="assets-mobile/framework7/css/framework7.min.css">
    <link rel="stylesheet" href="assets-mobile/css/icons.css">
    <link rel="stylesheet" href="assets-mobile/css/app.css?2018051402">
    <link rel="stylesheet" href="assets-mobile/css/c3.min.css">
    <script type="text/javascript" charset="utf-8" src="js/PushNotification.js"></script>
     <script type="text/javascript" src="cordova.js"></script>
    <script src="assets-mobile/js/d3.v4.min.js" charset="utf-8"></script>
    <script src="assets-mobile/js/c3.min.js" charset="utf-8"></script>

</head>
<body>
<div id="app">
    <div class="views tabs ios-edges">
        <div id="view-home" class="view view-main tab tab-active">
            <div class="page" data-name="home">
                <div class="navbar">
                    <div class="navbar-inner">
                        <div class="title sliding">My Sites</div>
                    </div>
                </div>
                <div class="page-content" id="site_list">
                                       
                                    </div>
            </div>
        </div>
        <div id="view-alarm" class="view tab"></div>
        <div id="view-myaccount" class="view tab"></div>

        <div id="view-settings" class="view tab"></div>

        <div class="toolbar tabbar toolbar-bottom-md">
            <div class="toolbar-inner">
                <a href="/mysites" class="tab-link external">
                    <i class="icon f7-icons ios-only">list</i>
                    <i class="icon material-icons md-only">home</i>
                </a>
                <a href="#view-home" class="tab-link">
                    <i class="icon material-icons">dashboard</i>
                </a>
                <a href="#view-alarm" class="tab-link">
                    <i class="icon f7-icons">bell<span class="badge color-red">3</span></i>
                </a>
                <a href="#view-myaccount" class="tab-link">
                    <i class="icon f7-icons ios-only">person</i>
                    <i class="icon material-icons md-only">person</i>
                </a>
            </div>
        </div>
    </div>
</div>
<div class="popup popup-tablet-fullscreen" id="pop_contents">
    


    <div class="views tabs ios-edges">
        <div id="view-home" class="view view-main tab tab-active">
            
        <div class="page page-current" data-name="dashboard">
        <div class="navbar">
            <div class="navbar-inner sliding">
                <div class="left">
                    <a href="#" class="link back" onclick="pop_close();">
                        <i class="icon icon-back"></i>
                        
                    </a>
                </div>
                <div class="title">Dashboard</div>
                <div class="right">
                    <a href="#" data-popup=".setting-popup" class="popup-open link">
                        <i class="icon f7-icons">gear</i>
                    </a>
                </div>
            </div>
        </div>

<div class="popup setting-popup">
            <div class="view">
                <div class="page">
                    <div class="navbar">
                        <div class="navbar-inner">
                            <!-- 팝업 타이틀 가운데 정렬을 위해 안 보이는 아이콘 -->
                            <div class="left">
                                <a class="link popup-close">
                                <i class="icon color-blue material-icons ">close</i>
                                </a>
                            </div>
                            <div class="title">Settings</div>
                            <div class="right">
                                <!-- Link to close popup -->
                                <a class="link popup-close"  data-popup=".setting-popup">
                                    <i class="icon material-icons">close</i>
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="page-content">
                        <div class="block-title">General <div class="float-right"><?=$obj['result_info']['domain']?></div></div>
                        <div class="list simple-list">
                            <ul>
                                <li>
                                    <span>Bypass Mode</span>
                                    <label class="toggle toggle-init color-red">
                                        <input type="checkbox">
                                        <span class="toggle-icon"></span>
                                    </label>
                                </li>
                            </ul>
                        </div>

                        <div class="block-title">Redirection Settings</div>
                        <div class="list simple-list">
                            <ul>
                                <li>
                                    <span>Redirect to www</span>
                                    <label class="toggle toggle-init color-blue">
                                        <input type="checkbox" checked="checked">
                                        <span class="toggle-icon"></span>
                                    </label>
                                </li>
                                <li>
                                    <span>Redirect to HTTPS</span>
                                    <label class="toggle toggle-init color-blue">
                                        <input type="checkbox" checked="checked">
                                        <span class="toggle-icon"></span>
                                    </label>
                                </li>
                            </ul>
                        </div>

                    </div>
                </div>
            </div>
            ...
        </div>

        <div class="tabs" style="overflow-y: auto;">
            <div id="tab-visits" class="page-content tab tab-active" style="overflow-y: auto;">
                <div class="list">
                    <ul>
                        <li>
                            <div class="item-content">
                                <div class="item-media" id="status_image"></div>
                                <div class="item-inner">
                                    <div class="item-title domain-status" id="status"></div>
                                    <div class="item-after" id="domain_name"></div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="block">
                    <div class="segmented">
                        <a href="#tab-visits" class="button button-round button-outline button-active tab-link">Visits</a>
                        <a href="#tab-attacks" class="button button-round button-outline color-red tab-link">Attacks</a>
                    </div>
                </div>
                <div class="block block-strong block-total-data">
                    <div class="row">
                        <div class="col total-traffic">
                            <dl class="total-data-list">
                                <dt class="">Total Traffic</dt>
                                <dd>May</dd>
                            </dl>
                            <div class="total-data-traffic" id="limit_traffic" ><?=intval($obj['result_info']['traffic']/1024/1024/1024)?>GB / <?=intval($obj['result_info']['limit_traffic']/1024/1024/1024)?>GB</div>
                        </div>
                        <div class="col total-visits">
                            <dl class="total-data-list">
                                <dt>Total Visits</dt>
                                <dd>May</dd>
                            </dl>
                            <div class="total-data-visits" id="total_visit"></div>
                        </div>
                    </div>
                </div>
                <div class="block-title">Total Visits</div>
                <div class="block block-strong" style="width:100%;">
                    <div id="chart-visits" class="c3" style="max-height: 320px; position: relative; ">
                        
                    </div>
                </div>
                <div class="block-title">Top Countries</div>
                <div class="block block-strong">
                    <div id="chart-countries" class="c3" style="max-height: 320px; position: relative;">
                    </div>
                </div>
                <div class="block-title">Traffic By Day</div>
                <div class="block block-strong">
                    <div id="chart-traffic" class="c3" style="max-height: 320px; position: relative;">
                    </div>
                </div>
            </div>
            <div id="tab-attacks" class="page-content tab" style="overflow-y: auto;">
                <div class="list">
                    <ul>
                        <li>
                            <div class="item-content">
                                <div class="item-media" id="status_image_a"></div>
                                <div class="item-inner">
                                    <div class="item-title domain-status" id="status_a"></div>
                                    <div class="item-after" id="domain_name_a"></div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="block">
                    <div class="segmented">
                        <a href="#tab-visits" class="button button-round button-outline tab-link">Visits</a>
                        <a href="#tab-attacks" class="button button-round button-outline button-active color-red tab-link">Attacks</a>
                    </div>
                </div>
                <div class="block block-strong block-total-data">
                    <div class="row">
                        <div class="col total-traffic">
                            <dl class="total-data-list">
                                <dt>Total Traffic</dt>
                                <dd>May</dd>
                            </dl>
                            <div class="total-data-traffic" id="limit_traffic_a" ></div>
                        </div>
                        <div class="col total-visits">
                            <dl class="total-data-list">
                                <dt>Total Attacks</dt>
                                <dd>May</dd>
                            </dl>
                            <div class="total-data-attacks" id="total_attack"></div>
                        </div>
                    </div>
                </div>
                <div class="block-title">Total Attacks</div>
                <div class="block block-strong">
                    <div id="chart-attacks" class="c3" style="max-height: 320px; position: relative;">

                </div>
                </div>
                <div class="block-title">Top Ips</div>
                <div class="block block-strong">
                    <div id="chart-ips" class="c3" style="max-height: 320px; position: relative;">
                        
                    </div>
                </div>
                <div class="block-title">Attack Purpose</div>
                <div class="block block-strong">
                    <div id="chart-purpose" class="c3" style="max-height: 320px; position: relative;">
                    </div>
                </div>
                <div class="block-title">Attack URLs</div>
                <div class="block block-strong">
                    <div id="chart-urls" class="c3" style="max-height: 320px; position: relative;">
                        
                    </div>
                </div>
            </div>
        </div>
    </div></div>
       
        <div id="view-myaccount" class="view tab"><div class="page page-current" data-name="myaccount">
        <div class="navbar">
            <div class="navbar-inner sliding">
                <div class="title">My Account</div>
            </div>
        </div>
        <div class="page-content">
            <div class="list">
                <ul>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title">E-mail Address : staff@greenolivetree.net</div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="block">
                <div class="row">
                    <button class="col button button-fill color-gray">Log Out</button>
                </div>
            </div>
        </div>
    </div></div>

        <div id="view-settings" class="view tab"></div>

        <div class="toolbar tabbar toolbar-bottom-md">
            <div class="toolbar-inner">
                <a href="/mysites" class="tab-link external">
                    <i class="icon f7-icons ios-only">list</i>
                    <i class="icon material-icons md-only">home</i>
                </a>
                <a href="#view-home" class="tab-link">
                    <i class="icon material-icons">dashboard</i>
                </a>
                <a href="#view-alarm" class="tab-link">
                    <i class="icon f7-icons">bell<span class="badge color-red">3</span></i>
                </a>
                <a href="#view-myaccount" class="tab-link">
                    <i class="icon f7-icons ios-only">person</i>
                    <i class="icon material-icons md-only">person</i>
                </a>
            <span class="tab-link-highlight" style="width: 25%;"></span></div>
        </div>
    </div>

      



  </div>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript" src="js/app.js"></script>
<script src="assets-mobile/framework7/js/framework7.min.js"></script>
<script src="assets-mobile/js/routes.js?2018051402"></script>
<script src="assets-mobile/js/app.js?2018051402"></script>

<script>

  $("#site_list").html('');
   $.post("http://topnailart.iwinv.net/sitelist.php",
   {
    
       },
   function(data){
     $("#site_list").html(data);
   
    
   });
   function pop_contents(domain_idx) {
    var domain_idx=domain_idx;
    
    app.popup.open("#pop_contents"); // 팝업창 열기
      $.post("http://topnailart.iwinv.net/site_display_data.php",
   {
        domain_idx:domain_idx
    
       },
   function(data){
    console.log(data);
    var site_data = JSON.parse(data);
   
    switch (site_data.status) {
    case 'Protected':
                                        status_image = 'protected';
                                        break;
                                    case 'Bypass':
                                        status_image = 'bypass';
                                        break;
                                    case 'Pending':
                                        status_image = 'pending';
                                        break;
                                    case 'Deleting':
                                        status_image = 'deleting';
                                        break;
                                    case 'Disconnected':
                                        status_image = 'disconnected';
                                        break;
}
var status_image_name="<img src='assets-mobile/img/"+status_image+".png' alt='"+status_image+"'>";
 $("#domain_name").html(site_data.domain);
$("#status_image").html(status_image_name);
$("#status").html(status_image);
 $("#domain_name_a").html(site_data.domain);
$("#status_image_a").html(status_image_name);
$("#status_a").html(status_image);
var traffic=parseInt(site_data.traffic/1024/1024/1024);
var limit_traffic=parseInt(site_data.limit_traffic/1024/1024/1024);

$("#limit_traffic").html(traffic+"G/"+limit_traffic+"G");
$("#limit_traffic_a").html(traffic+"G/"+limit_traffic+"G")
 
 
     //$("#pop_contents").html(data);
    
   });
   // 방문자 

       $.post("http://topnailart.iwinv.net/site_visit_data.php",
   {
        domain_idx:domain_idx
    
       },
   function(data){
   
    var visit_data = JSON.parse(data);
   
var total_visit=visit_data.total_count.visits;
var total_attack=visit_data.total_count.attacks;
 $("#total_visit").html(total_visit);
$("#total_attack").html(total_attack);

 // 차트 
 var chart = c3.generate({
    bindto: '#chart-visits',
   data: {
    json: visit_data.total_log
        
    ,
    type: 'area-spline',
    groups:[['visits']],
    keys: {
      x: 'date',
      value: ["visits"]
    }
  },
  axis: {
    x: {
      type: 'timeseries',
            tick: {
                format: '%d'
            }
    }
  }
});


 // 공격차트 
 var chart = c3.generate({
    bindto: '#chart-attacks',
   data: {
    json: visit_data.total_log
        
    ,
    type: 'area-spline',
    groups:[['attacks']],
    keys: {
      x: 'date',
      value: ["attacks"]
    }
  },
  axis: {
    x: {
      type: 'timeseries',
            tick: {
                format: '%d'
            }
    }
  }
});

    
   });

//top_ips

 $.post("http://topnailart.iwinv.net/site_top_ips.php",
   {
        domain_idx:domain_idx
    
       },
   function(data){
var ips_data = $.parseJSON(data);
    
 var chartIps = c3.generate({
                    bindto: '#chart-ips',
                    data: {
                        json: ips_data,
                        keys: {
                            x: 'ip',
                            value: ['count']
                        },
                        type: 'bar',
                        colors: {
                            count: '#d62728'
                        },
                        empty: {
                            label: {
                                text: "No Data"
                            }
                        }
                    },
                    axis: {
                        x: {
                            type: 'category'
                        },
                        y: {
                            tick: {
                                format: function(d) {
                                    return d.toFixed(0);
                                },
                                count: 5
                            }
                        },
                        rotated: true,
                    },
                    bar: {
                        width: 20
                    }
                });
});

//

//chart-countries

 $.post("http://topnailart.iwinv.net/site_top_countries.php",
   {
        domain_idx:domain_idx
    
       },
   function(data){
var countries_data = $.parseJSON(data);

    var chartCountries = c3.generate({
                    bindto: '#chart-countries',
                    data: {
                        json: countries_data,
                        keys: {
                            x: 'country',
                            value: ['count']
                        },
                        type: 'bar'
                    },
                    axis: {
                        x: {
                            type: 'category'
                        },
                        rotated: true
                    },
                    bar: {
                        width: 20
                    }
                });

});


// traffic by day
 $.post("http://topnailart.iwinv.net/site_traffic_day.php",
   {
        domain_idx:domain_idx
    
       },
   function(data){
var Traffic_data = $.parseJSON(data);
var chartTraffic = c3.generate({
                    bindto: '#chart-traffic',
                    padding: {
                        left: 60
                    },
                    data: {
                        json: Traffic_data,
                        keys: {
                            x: 'date',
                            value: ['traffic']
                        },
                        type: 'bar'
                    },
                    axis: {
                        x: {
                            type: 'timeseries',
                            tick: {
                                format: '%m/%d',
                                count: 7
                            }
                        },
                        y: {
                            tick: {
                                format: function(d) {
                                    return (d / 1024 / 1024).toFixed(1) + 'MB';
                                },
                                count: 5
                            }
                        }
                    },
                    bar: {
                        width: {
                            ratio: 0.1
                        }
                    }
                });

});


 // attack_purpose.php
 $.post("http://topnailart.iwinv.net/site_attack_purpose.php",
   {
        domain_idx:domain_idx
    
       },
   function(data_purpose) {
 
var Purpose_data = $.parseJSON(data_purpose);


var json = Purpose_data;
var pieJson = {};
json.purpose.forEach(function (purpose, index) {
  pieJson[purpose] = json.count[index];
});


 var chartPurpose = c3.generate({
                    bindto: '#chart-purpose',
                    data: {
                        json: pieJson,
                        type: 'pie',
                        empty: {
                            label: {
                                text: "No Data"
                            }
                        }
                    },
                    color: {
                        pattern: ['#d62728', '#ff7f0e', '#8c564b', '#ffbb78', '#ff9896', '#7f7f7f', '#c7c7c7']
                    },
                    pie: {
                        label: {
                            format: function (value) {
                                return value;
                            }
                        }
                    }
                });





});


  // attack_url.php
 $.post("http://topnailart.iwinv.net/site_attack_url.php",
   {
        domain_idx:domain_idx
    
       },
   function(data) {
   
var url_data = $.parseJSON(data);


var json = url_data;
var pieJson = {};
json.uri.forEach(function (uri, index) {
  pieJson[uri] = json.count[index];
});


var chartUrls = c3.generate({
                    bindto: '#chart-urls',
                    data: {
                        json: pieJson,
                        type: 'pie',
                        empty: {
                            label: {
                                text: "No Data"
                            }
                        }
                    },
                    color: {
                        pattern: ['#d62728', '#ff7f0e', '#8c564b', '#ffbb78', '#ff9896', '#7f7f7f', '#c7c7c7']
                    },
                    pie: {
                        label: {
                            format: function (value) {
                                return value;
                            }
                        }
                    }
                });





});


   }



   function pop_close(){
    app.popup.close("#pop_contents");
    

   }

    

</script>
</body>
</html>
